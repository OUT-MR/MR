<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BUILD A PLATE</title>
  <style>
    :root{
      --bg:#F6F2EA;
      --ink:#0B0F0D;
      --muted:rgba(11,15,13,.65);
      --line:rgba(11,15,13,.12);
      --accent:#0F2A22;
      --radius:14px;
      --max:1200px;

      /* samma bakgrund här också */
      --plateBg:url("assets/plate-bg.png");
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background:var(--bg);
      color:var(--ink);
      -webkit-font-smoothing: antialiased;
    }
    a{color:inherit;text-decoration:none}
    button{font-family:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:0 18px 60px}

    /* Header */
    .header{
      position:sticky;
      top:0;
      z-index:50;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 18px;
      background:rgba(246,242,234,.92);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(10px);
    }
    .hleft,.hright{display:flex; align-items:center; gap:14px; min-width:220px}
    .hcenter{display:flex; align-items:center; justify-content:center; flex:1}
    .logo{letter-spacing:.22em;font-weight:700;font-size:13px;text-transform:uppercase}
    .iconBtn{
      width:36px;height:36px;border:0;background:transparent;color:inherit;cursor:pointer;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
    }
    .iconBtn:hover{background:rgba(11,15,13,.06)}
    .badge{
      position:absolute; transform:translate(10px,-10px);
      background:var(--accent); color:#fff; font-size:11px; padding:2px 6px; border-radius:999px;
      border:2px solid rgba(246,242,234,.92);
    }
    .iconWrap{position:relative; display:inline-flex}

    /* Layout */
    .main{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      margin-top:12px;
      align-items:start;
    }

    /* ======= BAKGRUNDEN PÅ PRODUKTBILDEN ======= */
    .media{
      border-radius:var(--radius);
      overflow:hidden;
      border:1px solid var(--line);

      background-image: var(--plateBg);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      padding:28px 22px 26px;

      position:sticky;
      top:78px;
    }
    .media img{
      width:100%;
      height:min(78vh, 760px);
      object-fit:contain;
      display:block;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.25));
    }
    /* ========================================== */

    .panel{
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(255,255,255,.78);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .pad{padding:16px}

    .kicker{
      margin:0 0 8px;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
    }
    h1{
      margin:0 0 8px;
      font-size:28px;
      letter-spacing:-.02em;
      line-height:1.08;
    }
    .desc{margin:0; color:var(--muted); font-size:13px}
    .divider{height:1px; background:var(--line); margin:14px 0}

    .stepTitle{
      margin:0 0 10px;
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
    }

    .packs{display:flex; flex-direction:column; gap:8px}
    .pack{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
      background:rgba(255,255,255,.75);
    }
    .pack.active{
      border-color:rgba(15,42,34,.55);
      box-shadow: 0 0 0 2px rgba(15,42,34,.10) inset;
    }
    .pack b{font-size:13px}
    .pack span{font-size:12px;color:var(--muted)}
    .lock{font-size:12px;color:rgba(11,15,13,.45)}

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px;
      margin-top:10px;
    }
    .field{display:flex; flex-direction:column; gap:6px}
    label{font-size:12px;color:var(--muted)}
    input, select{
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-size:14px;
      outline:none;
    }
    .full{grid-column:1 / -1}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{
      border-radius:999px;
      padding:10px 14px;
      font-weight:650;
      font-size:13px;
      border:1px solid var(--line);
      background:transparent;
      color:var(--ink);
      cursor:pointer;
    }
    .btn.primary{
      background:var(--ink);
      border-color:var(--ink);
      color:#fff;
    }
    .btn.soft{background:rgba(255,255,255,.78)}

    .summary{
      margin-top:10px;
      padding:12px;
      border-radius:12px;
      border:1px dashed var(--line);
      color:var(--muted);
      font-size:13px;
      white-space:pre-wrap;
      background:rgba(255,255,255,.60);
    }

    /* Overlays */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(11,15,13,.55);
      display:none;
      z-index:80;
    }
    .overlay.open{display:block}
    .sheet{
      position:absolute;
      top:0; right:0;
      width:min(520px, 100%);
      height:100%;
      background:rgba(246,242,234,.98);
      border-left:1px solid var(--line);
      padding:16px;
      overflow:auto;
    }
    .sheetTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:6px 0 12px;
      border-bottom:1px solid var(--line);
      margin-bottom:12px;
    }
    .x{
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid var(--line);
      background:transparent;
      cursor:pointer;
    }
    .list{display:flex; flex-direction:column; gap:10px}
    .rowItem{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.6);
      cursor:pointer;
    }
    .thumb{
      width:56px; height:56px;
      border-radius:12px;
      overflow:hidden;
      flex:none;
      background:#ddd;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .rowItem b{font-size:13px}
    .rowItem span{font-size:12px;color:var(--muted)}
    .muted{color:var(--muted); font-size:13px; margin:10px 0 0}

    @media (max-width: 980px){
      .main{grid-template-columns:1fr}
      .media{position:relative; top:auto}
      .media img{height:56vh}
      .hleft,.hright{min-width:auto}
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="hleft">
      <button class="iconBtn" id="backBtn" aria-label="Back">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M15 6 9 12l6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="iconBtn" id="searchBtn" aria-label="Search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
          <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="hcenter">
      <div class="logo">BUILD A PLATE</div>
    </div>

    <div class="hright">
      <button class="iconBtn" id="loginBtn" aria-label="Login">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" stroke="currentColor" stroke-width="2"/>
          <path d="M20 21a8 8 0 1 0-16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <span class="iconWrap">
        <button class="iconBtn" id="bagBtn" aria-label="Bag">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 8h12l-1 13H7L6 8Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M9 8a3 3 0 0 1 6 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <span class="badge" id="bagCount" style="display:none">0</span>
      </span>
    </div>
  </header>

  <div class="wrap">
    <div class="main">
      <div class="media">
        <img id="dishImg" src="assets/hero.jpg" alt="Rätt" />
      </div>

      <div class="panel">
        <div class="pad">
          <p class="kicker" id="dishCat">Kategori</p>
          <h1 id="dishName">Rätt</h1>
          <p class="desc">Du bygger rätten steg för steg. Priser visas när du väljer paket.</p>

          <div class="divider"></div>

          <p class="stepTitle">1. Välj paket</p>
          <div class="packs" id="packs"></div>
          <div class="summary" id="priceLine">Välj ett paket för att se pris.</div>

          <div class="divider"></div>

          <p class="stepTitle">2. Leverans</p>
          <div class="form">
            <div class="field">
              <label>Namn</label>
              <input id="name" type="text" placeholder="Ditt namn" />
            </div>
            <div class="field">
              <label>Telefon</label>
              <input id="phone" type="text" placeholder="+46..." />
            </div>

            <div class="field">
              <label>Leverans eller hämtning</label>
              <select id="method">
                <option value="leverans">Leverans</option>
                <option value="hamtning">Hämtning</option>
              </select>
            </div>
            <div class="field">
              <label>Datum och tid</label>
              <input id="datetime" type="text" placeholder="t.ex. Lör 18:00" />
            </div>

            <div class="field full" id="addressWrap">
              <label>Adress (för leverans)</label>
              <input id="address" type="text" placeholder="Gata, postnummer, ort" />
            </div>
          </div>

          <div class="divider"></div>

          <p class="stepTitle">3. Betala</p>
          <div class="actions">
            <button class="btn soft" id="addBtn" type="button">Lägg i bag</button>
            <button class="btn soft" id="copyBtn" type="button">Kopiera order</button>
            <button class="btn primary" id="payBtn" type="button">Gå till betalning</button>
          </div>

          <div class="summary" id="orderBox">—</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const PAY_LINKS = { duo:"#", par:"#", trio:"#", squad:"#", plato:"#"};

    const DISHES = [
      { id:"truffle", name:"Tagliatelle al Tartufo", cat:"Pasta", img:"https://source.unsplash.com/1600x2000/?pasta,truffle" },
      { id:"cacio", name:"Cacio e Pepe", cat:"Pasta", img:"https://source.unsplash.com/1600x2000/?pasta,cheese" },
      { id:"vodka", name:"Vodka Pasta + burrata", cat:"Pasta", img:"https://source.unsplash.com/1600x2000/?pasta,burrata" },
      { id:"meatballs", name:"Köttbullar 2.0", cat:"Nordic", img:"https://source.unsplash.com/1600x2000/?meatballs,swedish" },
      { id:"steak", name:"Biff + chimichurri", cat:"Nordic", img:"https://source.unsplash.com/1600x2000/?steak,chimichurri" },
      { id:"salmon", name:"Lax + misosmör", cat:"Nordic", img:"https://source.unsplash.com/1600x2000/?salmon,miso" },
      { id:"temaki", name:"Temaki Kit (tillagat protein)", cat:"Sushi", img:"https://source.unsplash.com/1600x2000/?temaki,sushi" },
      { id:"poke", name:"Poke Bowl", cat:"Sushi", img:"https://source.unsplash.com/1600x2000/?poke,bowl" },
      { id:"halloumi", name:"Halloumi bowl + chimichurri", cat:"Veg", img:"https://source.unsplash.com/1600x2000/?halloumi,salad" }
    ];

    const PACKS = [
      { key:"duo", label:"Duo", people:2, price:399 },
      { key:"par", label:"Par", people:2, price:449 },
      { key:"trio", label:"Trio", people:3, price:499 },
      { key:"squad", label:"Squad", people:4, price:599 },
      { key:"plato", label:"Plato Mode", people:3, price:549 }
    ];

    const CART_KEY = "bap_cart_v1";
    function getCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); } catch { return []; } }
    function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); renderBagBadge(); }
    function renderBagBadge(){
      const n = getCart().length;
      const el = document.getElementById("bagCount");
      el.style.display = n ? "inline-flex" : "none";
      el.textContent = n;
    }
    renderBagBadge();

    const qs = new URLSearchParams(location.search);
    const id = qs.get("id");
    const dish = DISHES.find(d => d.id === id) || DISHES[0];

    const dishImg = document.getElementById("dishImg");
    const dishName = document.getElementById("dishName");
    const dishCat = document.getElementById("dishCat");
    dishImg.src = dish.img;
    dishName.textContent = dish.name;
    dishCat.textContent = dish.cat;
    dishImg.onerror = () => dishImg.src = "assets/hero.jpg";

    const packsEl = document.getElementById("packs");
    const priceLine = document.getElementById("priceLine");
    const orderBox = document.getElementById("orderBox");

    const nameEl = document.getElementById("name");
    const phoneEl = document.getElementById("phone");
    const methodEl = document.getElementById("method");
    const datetimeEl = document.getElementById("datetime");
    const addressWrap = document.getElementById("addressWrap");
    const addressEl = document.getElementById("address");

    let selectedPackKey = null;

    function syncAddress(){
      addressWrap.style.display = (methodEl.value === "leverans") ? "" : "none";
    }
    methodEl.addEventListener("change", () => { syncAddress(); updateOrderBox(); });
    [nameEl, phoneEl, datetimeEl, addressEl].forEach(el => el.addEventListener("input", updateOrderBox));

    function renderPacks(){
      packsEl.innerHTML = "";
      PACKS.forEach(p => {
        const row = document.createElement("div");
        row.className = "pack";
        row.dataset.pack = p.key;
        row.innerHTML = `
          <div>
            <b>${p.label}</b><br/>
            <span>${p.people} personer</span>
          </div>
          <div class="lock"></div>
        `;
        row.onclick = () => selectPack(p.key);
        packsEl.appendChild(row);
      });
      updatePackUI();
    }

    function selectPack(key){
      selectedPackKey = key;
      updatePackUI();
      updateOrderBox();
    }

    function updatePackUI(){
      document.querySelectorAll(".pack").forEach(el => {
        el.classList.toggle("active", el.dataset.pack === selectedPackKey);
      });

      if(!selectedPackKey){
        priceLine.textContent = "Välj ett paket för att se pris.";
        return;
      }

      const p = PACKS.find(x => x.key === selectedPackKey);
      priceLine.textContent = `Pris: ${p.price} SEK · ${p.label} (${p.people})`;
    }

    function buildOrderText(){
      const p = selectedPackKey ? PACKS.find(x => x.key === selectedPackKey) : null;
      const method = methodEl.value === "leverans" ? "Leverans" : "Hämtning";
      const address = methodEl.value === "leverans" ? (addressEl.value.trim() || "—") : "—";

      return [
        `Rätt: ${dish.name}`,
        `Paket: ${p ? p.label : "—"} (${p ? p.people : "—"})`,
        `Pris: ${p ? p.price : "—"} SEK`,
        `Namn: ${nameEl.value.trim() || "—"}`,
        `Telefon: ${phoneEl.value.trim() || "—"}`,
        `Datum/tid: ${datetimeEl.value.trim() || "—"}`,
        `Metod: ${method}`,
        `Adress: ${address}`,
        `Område: Västmanlands län`
      ].join("\n");
    }

    function updateOrderBox(){ orderBox.textContent = buildOrderText(); }

    function validForPay(){
      if(!selectedPackKey) return false;
      if(!nameEl.value.trim()) return false;
      if(!phoneEl.value.trim()) return false;
      if(!datetimeEl.value.trim()) return false;
      if(methodEl.value === "leverans" && !addressEl.value.trim()) return false;
      return true;
    }

    document.getElementById("addBtn").onclick = () => {
      if(!selectedPackKey){ alert("Välj paket först."); return; }
      const p = PACKS.find(x => x.key === selectedPackKey);
      const cart = getCart();

      const item = { id:dish.id, name:dish.name, img:dish.img, pack:`${p.label} (${p.people})` };
      const next = cart.filter(x => x.id !== dish.id);
      next.push(item);
      setCart(next);
      alert("Tillagd i bag.");
    };

    document.getElementById("copyBtn").onclick = async () => {
      const text = buildOrderText();
      try{ await navigator.clipboard.writeText(text); alert("Kopierat."); }
      catch{ alert("Kunde inte kopiera. Markera texten manuellt."); }
    };

    document.getElementById("payBtn").onclick = () => {
      if(!validForPay()){ alert("Fyll i paket, namn, telefon, datum/tid och adress (om leverans)."); return; }
      const link = PAY_LINKS[selectedPackKey] || "#";
      if(link === "#"){ alert("Lägg in din Stripe Payment Link i PAY_LINKS för detta paket."); return; }
      window.open(link, "_blank");
    };

    document.getElementById("backBtn").onclick = () => { window.location.href = "index.html"; };
    document.getElementById("loginBtn").onclick = () => alert("Logga in kommer snart.");

    syncAddress();
    renderPacks();
    updateOrderBox();
  </script>
</body>
</html>
